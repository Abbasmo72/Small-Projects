## نظارت بر مصرف CPU
این کد یک برنامه‌ی پایتونی برای نظارت بر مصرف CPU است که از کتابخانه‌ی psutil برای بررسی وضعیت استفاده می‌کند. هدف برنامه شناسایی موقعیت‌هایی است که مصرف CPU از حد معین (به طور پیش‌فرض 80%) عبور می‌کند و اقدامات لازم برای مدیریت آن را انجام می‌دهد.

## تحلیل کلاس CpuMonitor
- سازنده‌ی کلاس: در زمان ایجاد یک شیء از کلاس، دو پارامتر max_usage (حداکثر مجاز مصرف CPU) و check_interval (فاصله زمانی بررسی مصرف) مقداردهی می‌شوند. این مقادیر قابل تغییر هستند و می‌توان بر اساس نیاز تنظیمشان کرد.
- تابع check_cpu_usage: این تابع مسئول محاسبه‌ی مصرف CPU در لحظه است. با استفاده از تابع cpu_percent از کتابخانه‌ی psutil، مصرف CPU در بازه‌ی مشخص‌شده بررسی می‌شود. نتیجه به صورت درصد چاپ شده و مقدار بازگشتی تابع، مصرف فعلی CPU است.
- تابع monitor_cpu: این تابع یک حلقه‌ی بی‌نهایت اجرا می‌کند که به صورت مداوم مصرف CPU را بررسی می‌کند. اگر مصرف از حد مجاز عبور کند، هشدار داده و تابع take_action برای مدیریت وضعیت فراخوانی می‌شود. فاصله بین بررسی‌ها با استفاده از متغیر check_interval تنظیم می‌شود.
- تابع take_action: در صورت عبور مصرف CPU از حد مجاز، این تابع به اجرا درمی‌آید. ابتدا لیستی از پروسه‌های در حال اجرا تهیه می‌کند و پروسه‌هایی که مصرف CPU آن‌ها بالای 20% است را شناسایی می‌کند. سپس اطلاعات این پروسه‌ها شامل PID، نام و درصد مصرف CPU نمایش داده می‌شود. همچنین این امکان وجود دارد که پروسه‌های پرمصرف را با استفاده از متد terminate متوقف کند (در کد به صورت توضیح نوشته شده).

## نحوه عملکرد برنامه
- با اجرای فایل اصلی، یک شیء از کلاس CpuMonitor با مقادیر پیش‌فرض (حد مصرف 80% و فاصله زمانی 1 ثانیه) ساخته می‌شود.
- برنامه وارد حلقه‌ی نظارت می‌شود و به صورت مداوم مصرف CPU را بررسی می‌کند. در صورت تجاوز از حد تعیین‌شده، اقدام مناسب انجام می‌شود.
- اطلاعات پروسه‌های پرمصرف در صورت وجود نمایش داده می‌شود.

## نقاط قوت
- این کد نظارتی پویا بر مصرف CPU ارائه می‌دهد و ابزار مناسبی برای شناسایی پروسه‌های پرمصرف است.
- امکان سفارشی‌سازی حد مصرف و فاصله‌ی بررسی وجود دارد که انعطاف‌پذیری بالایی به کد می‌دهد.
- از کتابخانه‌ی قدرتمند psutil استفاده شده که اطلاعات دقیقی از وضعیت سیستم ارائه می‌کند.

## نکات بهبود
- در صورتی که بخواهید پروسه‌ای متوقف شود، بهتر است تأیید کاربر قبل از پایان دادن به پروسه دریافت شود تا از توقف پروسه‌های حیاتی جلوگیری شود.
- برای کاهش فشار ناشی از حلقه‌ی بی‌نهایت، می‌توان فاصله‌ی بررسی‌ها را متناسب با نیاز طولانی‌تر کرد.
- افزودن قابلیت ثبت اطلاعات مصرف CPU و گزارش‌گیری از تاریخچه برای تحلیل‌های بیشتر می‌تواند کاربرد برنامه را افزایش دهد.
- در مواردی که پروسه‌های پرمصرف پیدا نمی‌شود، می‌توان پیشنهاداتی برای آزاد کردن منابع ارائه داد، مثل بستن برنامه‌های غیرضروری.

این برنامه برای محیط‌های توسعه و یا سیستم‌های نظارتی می‌تواند بسیار مفید باشد.


## کد پایتون
```python
import psutil
import time

class CpuMonitor:
    def __init__(self, max_usage=80, check_interval=1):
        self.max_usage = max_usage  # حد مصرف CPU
        self.check_interval = check_interval  # فاصله زمانی بین بررسی‌ها

    def check_cpu_usage(self):
        """بررسی مصرف فعلی CPU"""
        usage = psutil.cpu_percent(interval=self.check_interval)
        print(f"مصرف CPU: {usage}%")
        return usage

    def monitor_cpu(self):
        """نظارت مداوم بر مصرف CPU و هشدار در صورت عبور از حد مجاز"""
        while True:
            usage = self.check_cpu_usage()
            if usage > self.max_usage:
                print(f"هشدار: مصرف CPU از {self.max_usage}% بیشتر شد!")
                self.take_action()
            time.sleep(self.check_interval)

    def take_action(self):
        """اقدام در صورت عبور مصرف CPU از حد مجاز"""
        print("در حال انجام اقدامات برای کاهش مصرف CPU...")
        # به عنوان مثال می‌توانید برنامه‌های پرمصرف را متوقف کنید
        # مثلاً با استفاده از psutil می‌توانید پروسه‌هایی که CPU زیادی مصرف می‌کنند را شناسایی کرده و متوقف کنید
        # این قسمت می‌تواند بر اساس نیاز شما تغییر یابد.

        # به عنوان نمونه، لیست پروسه‌ها را می‌گیریم و پروسه‌های پرمصرف را نمایش می‌دهیم
        processes = psutil.process_iter(['pid', 'name', 'cpu_percent'])
        high_cpu_processes = [p for p in processes if p.info['cpu_percent'] > 20]

        if high_cpu_processes:
            print("پروسه‌های با مصرف CPU بالا:")
            for proc in high_cpu_processes:
                print(f"PID: {proc.info['pid']} - نام: {proc.info['name']} - مصرف CPU: {proc.info['cpu_percent']}%")
                # اگر لازم باشد می‌توانید این پروسه‌ها را متوقف کنید:
                # proc.terminate()  # این خط پروسه را متوقف می‌کند
        else:
            print("هیچ پروسه‌ای با مصرف بالا پیدا نشد.")

if __name__ == "__main__":
    cpu_monitor = CpuMonitor(max_usage=80, check_interval=1)  # حد مصرف 80% و فاصله زمانی 1 ثانیه
    cpu_monitor.monitor_cpu()

```
